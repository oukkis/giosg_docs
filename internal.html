<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>giosg Internal Documentation</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

  </head>

  <body class="internal">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
      <ul class="toc-footer">
        <li><a href='./index.html'>Home</a></li>
        <li><a href='./http_api.html'>Giosg HTTP API</a></li>
        <li><a href='./visitor_http_api.html'>Visitor HTTP API</a></li>
        <li><a href='./javascript_api.html'>JavaScript SDK API</a></li>
        <li><a href='./giosg_apps.html'>Giosg APPS</a></li>
        <li><a href='./basket.html'>Giosg BASKET</a></li>
      </ul>
      <ul class="toc-footer">
        <li><a href='http://www.giosg.com' target="_blank">Sign Up on giosg.com</a></li>
        <li><a href="https://docs.giosg.com/doku.php?id=public:technical-documentation:backend-api" target="_blank">Old API documentation</a></li>
        <li><a href='https://github.com/tripit/slate' target="_blank">Documentation Powered by Slate</a></li>
      </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        
          <h1 id="api-guidelines">API guidelines</h1>

<aside class="info">
To write API code, you need to read and accept these terms and conditions ;)
</aside>

<h3 id="begin-the-url-with-api-lt-version-gt">Begin the URL with <code class="prettyprint">/api/&lt;version&gt;</code></h3>
<pre class="highlight plaintext"><code>/api/v5/orgs/&lt;organization_id&gt;/teams
</code></pre>

<p>Every API URL path must start with this. If following these guidelines, you should <strong>set your version number to <code class="prettyprint">v5</code>!</strong></p>

<p>If you later make backward-incompatible changes to your API that has already been &ldquo;published&rdquo; for customers, copy its implementation and tests as a new endpoint with higher version number.</p>

<h3 id="use-uuids-as-identifiers">Use UUIDs as identifiers</h3>

<p>From now on, all the IDs should be in UUID format (e.g. <code class="prettyprint">7f9e9580-095b-42c7-838c-c04e667b26f7</code>). If creating a new Django model, its primary key field should be a UUID field. For old models, a UUID field need to be added and backfilled. You can use <code class="prettyprint">giosgchat.modules.common.fields.UUIDField</code> until we upgrade to Django 1.8.</p>

<p>However, do <strong>not</strong> use the word &ldquo;uuid&rdquo; in resource attributes. For example, refer to a room with <code class="prettyprint">room_id</code> attribute, not <code class="prettyprint">room_uuid</code>.</p>

<h3 id="require-explicit-organization-or-user-id">Require explicit organization or user ID</h3>
<pre class="highlight plaintext"><code>/api/v5/orgs/7f9e9580-095b-42c7-838c-c04e667b26f7/teams
</code></pre>

<p>The rule of thumb, especially on API endpoints that list stuff: <strong>the same URL should return &ldquo;same things&rdquo;, no matter who is authenticated</strong>. Of course, permission may be denied with <code class="prettyprint">403</code> if the user does not have access to the endpoint or the resource. However, whenever the permission is granted, the contents of the list should be the same.</p>

<p>In practise, do <strong>NOT</strong> list &ldquo;my organization&rsquo;s teams&rdquo; like this: <code class="prettyprint">/api/v5/teams</code>. Instead, the URL should explicitly contain the organization ID.</p>

<p><strong>Any endpoint</strong> that is scoped to a single organization should begin with <code class="prettyprint">/api/&lt;version&gt;/orgs/&lt;organization_id&gt;/</code>. Similarly, any endpoint that returns something that is scoped to a single user should begin with <code class="prettyprint">/api/&lt;version&gt;/users/&lt;user_id&gt;/</code>.</p>

<p>This way the API can also be used in contexts where the authenticated user is allowed to access other organizations and users (resellers, super-users, networking, etc.). The downside is that you need to find out the organization ID before using the API. You can get the authenticated user&rsquo;s ID or the organization ID easily by using the special API endpoint <code class="prettyprint">/api/v5/users/me</code>!</p>
<pre class="highlight plaintext"><code>/api/v5/orgs/7f9e9580-095b-42c7-838c-c04e667b26f7/reports/visitorstats/timeseries
</code></pre>

<p>This also applies to reporting APIs. E.g. if you want to get a organization-wide report</p>

<h3 id="support-optional-url-trailing-slashes">Support optional URL trailing slashes</h3>
<pre class="highlight python"><code>    <span class="n">url</span><span class="p">(</span><span class="s">r"^api/v5/teams/?$"</span><span class="p">,</span> <span class="n">TeamListCreateAPIView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</code></pre>

<p>APIs must work with or without trailing slashes. However, when using the API, prefer leaving the trailing slash out, because Firefox would then show it better in network debugging tools.</p>

<p>In Django <code class="prettyprint">urls.py</code>, remember to end the URL pattern with <code class="prettyprint">/?$</code>, e.g.</p>

<h3 id="companies-are-quot-organizations-quot">Companies are &ldquo;organizations&rdquo;</h3>

<p>From now on, we should use the word &ldquo;organization&rdquo; instead of &ldquo;company&rdquo; in APIs and other &ldquo;public&rdquo; technical contexts. It is still OK to use &ldquo;company&rdquo; internally, but transition to &ldquo;organization&rdquo; is preferred.</p>

<p>The word can be shortened to <code class="prettyprint">org</code> or <code class="prettyprint">orgs</code> in URL paths and GET parameter names. For example: <code class="prettyprint">/api/v5/orgs/7f9e9580-095b-42c7-838c-c04e667b26f7/teams</code>. You shoud still use <code class="prettyprint">organization</code> on resource attributes.</p>

<h3 id="personnel-are-quot-users-quot">Personnel are &ldquo;users&rdquo;</h3>

<p>Use the word &ldquo;user&rdquo; instead of &ldquo;personnel&rdquo; or &ldquo;persons&rdquo; in API and other public technical contexts. The word &ldquo;personnel&rdquo; should only be used internally.</p>

<p>For example, organization members are returned by <code class="prettyprint">/api/v5/orgs/&lt;organization_id&gt;/users</code>, and an attribute referring to a personnel object should be named <code class="prettyprint">user_id</code>.</p>

<h3 id="giosg-ids-are-quot-tokens-quot">Giosg IDs are &ldquo;tokens&rdquo;</h3>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"visitor_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2bipq7y2xtgcyhzcweaafidbisd3lyar4s6f63cabdai37qm"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>If you have an attribute or parameter which has any Giosg-signed ID (i.e. &ldquo;Giosg ID&rdquo;), then use the word <code class="prettyprint">token</code> in its name.</p>

<h3 id="use-snake_case">Use snake_case</h3>

<p>You should <a href="https://en.wikipedia.org/wiki/Snake_case">snake_case</a> in both URL paths, GET parameters and object attributes! All words are in lower case. Avoid using camelCase or dashed-word-combinations.</p>

<p>UUIDs are an exception, of course, as they contain hyphens (e.g.<code class="prettyprint">7f9e9580-095b-42c7-838c-c04e667b26f7</code>).</p>

<h3 id="related-resources">Related resources</h3>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7f9e9580-095b-42c7-838c-c04e667b26f7"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"first_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"John"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"last_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Smith"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"organization_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7f9e9580-095b-42c7-838c-c04e667b26f7"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"organization"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7f9e9580-095b-42c7-838c-c04e667b26f7"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Example Ltd."</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Attributes that relate to another resource should be named with pattern <code class="prettyprint">&lt;relation&gt;_id</code>, for example <code class="prettyprint">organization_id</code>. The value should be the related resources identifier (UUID). This relation can then be easily changed by setting the value to another ID.</p>

<p>You can additionally serialize the related resource as a nested object, if convenient. In this case, give this attribute the same name as the ID attribute without the <code class="prettyprint">_id</code> suffix. This attribute must be <strong>read-only</strong>!</p>

<p>In this example, the <code class="prettyprint">organization_id</code> may feel redundant, but it is needed to make the relation updateable. For consistency and easier use, the ID attribute should always be returned even if the relation is not editable!</p>

<p><strong>PRO TIP!</strong> When serializing nested resources, use <a href="https://docs.djangoproject.com/en/1.8/ref/models/querysets/#select-related">Django querysets&rsquo; <code class="prettyprint">select_related</code></a> or <a href="https://docs.djangoproject.com/en/1.8/ref/models/querysets/#prefetch-related"><code class="prettyprint">prefetch_related</code></a> to improve your APIs performance!</p>

<h3 id="use-created_at-and-updated_at-for-creation-updating-timestamps">Use <code class="prettyprint">created_at</code> and <code class="prettyprint">updated_at</code> for creation/updating timestamps</h3>

<p>For every new resource, there should be timestamp attributes named <code class="prettyprint">created_at</code> and <code class="prettyprint">updated_at</code> (not <code class="prettyprint">modified_at</code>) indicating when the resource was created and when it was updated the last time.</p>

<h3 id="end-timestamp-attribute-names-with-_at">End timestamp attribute names with <code class="prettyprint">_at</code></h3>

<p>Your timestamp fields that contain a full timestamp (<code class="prettyprint">DateTimeField</code>) should end with <code class="prettyprint">_at</code> similar to <code class="prettyprint">created_at</code> and <code class="prettyprint">updated_at</code> timestamps.</p>

<h3 id="name-related-attributes-similarly-to-timestamp-fields">Name related attributes similarly to timestamp fields</h3>

<p>When providing information related to timestamps, e.g. who created or updated the resource, it is recommended to name the beginning of the attributes with the same word. For example, with <code class="prettyprint">created_at</code> you could provide attributes <code class="prettyprint">created_by_user</code> and <code class="prettyprint">created_by_user_id</code> (see <a href="#related-resources">Related resources</a>). Also: with <code class="prettyprint">updated_at</code> provide <code class="prettyprint">updated_by_user</code> and <code class="prettyprint">updated_by_user_id</code>.</p>

<h3 id="start-boolean-attribute-names-with-is_">Start boolean attribute names with <code class="prettyprint">is_</code></h3>

<p>Boolean attribute names should start with <code class="prettyprint">is_</code>, whenever possible. For example: <code class="prettyprint">is_closed</code>, <code class="prettyprint">is_active</code> or <code class="prettyprint">is_admin</code>.</p>

<h3 id="utc-is-the-default-time-zone">UTC is the default time zone</h3>

<p>Whenever your user provides date/time parameters <em>without time zone information</em>, it should be assumed to be in UTC time zone (+00:00). <strong>Also, your responses should always return date/times in UTC time zone!</strong></p>

<p>Your endpoint may take a time zone parameter if it would be useful, e.g. for getting daily reporting data. This may also affect the format of the returned date/times.</p>

<p>Do <strong>NOT</strong> automatically use the authenticated organization&rsquo;s or user&rsquo;s time zone preferences! This is because then the API would not be stateless any more. Instead, the client may retrieve the time zone setting separately (from <code class="prettyprint">/api/v5/users/me</code>) and provide it as a parameter for your API.</p>

<h3 id="render-and-accept-date-times-in-iso-8601-format">Render and accept date/times in ISO-8601 format</h3>
<pre class="highlight python"><code><span class="kn">from</span> <span class="nn">rest_framework</span> <span class="kn">import</span> <span class="n">serializers</span>
<span class="kn">from</span> <span class="nn">giosgchat.modules.common.api_v5.serializers</span> <span class="kn">import</span> <span class="n">UTCDateTimeField</span>

<span class="k">class</span> <span class="nc">MyModelSerializer</span><span class="p">(</span><span class="n">serializers</span><span class="o">.</span><span class="n">ModelSerializer</span><span class="p">):</span>
    <span class="n">created_at</span> <span class="o">=</span> <span class="n">UTCDateTimeField</span><span class="p">(</span><span class="n">read_only</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="c"># ...</span>
</code></pre>

<p>When returngin a date/time in a response, render it in ISO-8601 format (e.g. <code class="prettyprint">2015-08-31T16:32:17.879Z</code>).</p>

<ul>
<li>There must be <strong>exactly three (3) decimals for the second</strong></li>
<li>The date/time string <strong>must end with <code class="prettyprint">Z</code></strong></li>
</ul>

<aside class="success">
<strong>PRO TIP!</strong> Use <code>giosgchat.modules.common.api_v5.serializers.UTCDateTimeField</code> class, which handles this formatting automatically for you!
</aside>

<p>Also, if your API takes date/time parameters, the user should be able to provide it in ISO format. In these cases, the trailing <code class="prettyprint">Z</code> could be optional.</p>

<h3 id="use-django-rest-framework-3">Use Django REST framework 3</h3>

<p>If you are creating API views for creating, getting, listing, updating or destroying Django models, you should use <a href="http://www.django-rest-framework.org/api-guide/generic-views/">Django REST framework generic views</a>. In other cases, you should still use the framework&rsquo;s <a href="http://www.django-rest-framework.org/api-guide/views/">base view class</a> <code class="prettyprint">APIView</code>. This way you ensure that your views work consistently with all other views, in regards to response rendering, accept headers, authentication and permissions!</p>

<h3 id="use-pagination">Use pagination</h3>
<pre class="highlight python"><code><span class="kn">from</span> <span class="nn">rest_framework.pagination</span> <span class="kn">import</span> <span class="n">CursorPagination</span>

<span class="k">class</span> <span class="nc">MyResourceListCreateAPIView</span><span class="p">(</span><span class="n">ListCreateAPIView</span><span class="p">):</span>
    <span class="n">pagination_class</span> <span class="o">=</span> <span class="n">CursorPagination</span>
    <span class="c"># etc.</span>
</code></pre>

<p>If your API lists resources, it needs to be paginated. Use one of the pagination classes provided by REST framework 3, preferably <a href="http://www.django-rest-framework.org/api-guide/pagination/#cursorpagination">CursorPagination</a>.</p>

<p>Pagination is not required if your view restricts the maximum number of returned results in some other way. E.g. for getting a report for each day in a range, the maximum range is limited.</p>

<h3 id="allow-token-and-session-authentication">Allow token and session authentication</h3>
<pre class="highlight python"><code><span class="kn">from</span> <span class="nn">giosgchat.modules.common_api.rest_api</span> <span class="kn">import</span> <span class="n">PersonnelSessionAuthentication</span><span class="p">,</span> <span class="n">CompanyApiTokenAuthentication</span>

<span class="k">class</span> <span class="nc">MyResourceListCreateAPIView</span><span class="p">(</span><span class="n">ListCreateAPIView</span><span class="p">):</span>
    <span class="n">authentication_classes</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">CompanyApiTokenAuthentication</span><span class="p">,</span>
        <span class="n">PersonnelSessionAuthentication</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c"># etc.</span>
</code></pre>

<p>Your API user should always be able to <a href="https://docs.giosg.com/doku.php?id=public:technical-documentation:backend-api#authentication">authenticate with an API token, as documented</a>. In addition, you should support Django session authentication.</p>

<p>In other words, ensure that the following Authentication sub-classes are included in your authentication classes list:</p>

<h3 id="write-tests-first">Write tests first</h3>

<p>Test-driven-development is highly encouraged! First write a test for a one piece of functionality, let it fail, and then write the implementation. When the test passes, you can move to the next piece of functionality, possibly commiting your changes.</p>

<p>Please, try to be as thorough in your tests as possible. For all public APIs, the coverage should be near 100%.</p>

<h3 id="document-your-api">Document your API</h3>

<p>Add a documentation for your API to our <a href="https://github.com/giosg/giosg_docs"><code class="prettyprint">giosg_docs</code> repository</a>! You should create a new branch, write the documentation and create a pull request. On your code pull request you could add a link to this pull request.</p>

<h3 id="someone-reviews-your-api-against-these-guidelines">Someone reviews your API against these guidelines</h3>

<p>When you have created the pull request for your API implementation, someone should review your code and your documentation against these guidelines.</p>

      </div>
      <div class="dark-box">
      </div>
    </div>
  </body>
</html>
